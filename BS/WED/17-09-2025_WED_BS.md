## Mittwoch, 17-09-2025_BS_WED

# Benutzerverwaltung in Linux – kompakte Lern- und Prüfungsnotizen

## 1. Rechtekette `drwxr-xr-x` verständlich erklärt

- Position 1 = Dateityp:
  - `-` normale Datei
  - `d` Verzeichnis
  - `l` Symlink
  - weitere: `c` Char-Device, `b` Block-Device, `p` FIFO, `s` Socket
- Positionen 2–10 = Berechtigungen in Dreiergruppen für **User** (Besitzer), **Group** (Gruppenmitglieder), **Other** (alle anderen):
  - Reihenfolge pro Gruppe: `r` lesen, `w` schreiben, `x` ausführen
  - Beispiel `drwxr-xr-x`:
    - `d` Verzeichnis
    - `rwx` Owner darf alles
    - `r-x` Group darf lesen und ausführen
    - `r-x` Other darf lesen und ausführen
- Wichtiger Unterschied bei Verzeichnissen:
  - `x` bedeutet „betreten“ und Namen auflösen
  - `r` bedeutet „Inhalt auflisten“
  - `w` bedeutet „Einträge anlegen, löschen, umbenennen“
  - Beispiele:
    - Nur `x` auf einem Ordner: man kann hinein, aber keine Namen auflisten
    - `r-x` auf einem Ordner: man kann Inhalte sehen und hineingehen, aber nichts ändern

### Numerische und symbolische Schreibweise
- Zahlenwerte: `r=4`, `w=2`, `x=1`
  - `chmod 755 datei` → Owner 7 (rwx), Group 5 (r-x), Other 5 (r-x)
  - `chmod 640 datei` → Owner 6 (rw-), Group 4 (r--), Other 0 (---)
- Symbolisch:
  - `chmod u+x,g-w,o=rx datei`
  - rekursiv: `chmod -R 755 verzeichnis`
  - Referenz übernehmen: `chmod --reference=vorlage datei`

### Standardrechte und `umask`
- Ausgangsrechte vor `umask`: Dateien 666, Ordner 777
- Effektive Startrechte = Basis - `umask`
  - `umask 022` → Dateien 644, Ordner 755
- `umask` nur für neu erstellte Objekte

### Spezialbits: SUID, SGID, Sticky
- SUID (`chmod u+s` oder Bit 4000) auf **Datei**:
  - Programm läuft mit Rechten des Datei-Owners
  - Beispiel: `/usr/bin/passwd` läuft effektiv mit root-Rechten
- SGID (`chmod g+s` oder Bit 2000):
  - auf **Datei** ähnlich SUID für Gruppe
  - auf **Verzeichnis**: neue Dateien erben die Gruppen-ID des Ordners
  - Team-Ordner bauen: `chgrp projekt teamdir` und `chmod g+s teamdir`
- Sticky Bit (`chmod +t` oder Bit 1000) auf **Verzeichnis**:
  - Nur Besitzer des Eintrags oder root darf löschen
  - Beispiel: `/tmp` ist `drwxrwxrwt`

---

## 2. Benutzerkonten – Anlage, Änderung, Löschung

### Relevante Dateien
- `/etc/passwd` – Kontenstamm, Felder: name:x:uid:gid:gecos:home:shell
- `/etc/shadow` – Passworthashes und Alterung
- `/etc/group` – Gruppenliste
- `/etc/login.defs` – Defaults für `useradd` und Passwortrichtlinien

### Benutzer anlegen
- Distributionen:
  - Debian/Ubuntu: `adduser` (dialogbasiert, komfortabel), `useradd` (low-level)
  - RHEL/CentOS/Fedora: meist `useradd`
- Typische Befehle:
  - `sudo adduser alice` – interaktives Anlegen mit Home und Passwort
  - `sudo useradd -m -s /bin/bash alice` – Home anlegen, Shell setzen
  - Passwort setzen: `sudo passwd alice`
  - Primärgruppe setzen: `sudo useradd -g staff alice`
  - Sekundärgruppen ergänzen: `sudo usermod -aG sudo,docker alice`
    - Wichtig: `-aG` fügt hinzu, ohne vorhandene Sekundärgruppen zu verlieren

### Benutzer ändern
- Shell ändern: `sudo chsh -s /bin/zsh alice` oder `sudo usermod -s /bin/zsh alice`
- Home verschieben: `sudo usermod -d /srv/home/alice -m alice`
- Account sperren oder entsperren:
  - `sudo usermod -L alice` sperren, `sudo usermod -U alice` entsperren
  - oder `sudo passwd -l alice`, `sudo passwd -u alice`
- UID oder GID ändern, Vorsicht wegen Besitzrechten im Dateisystem:
  - `sudo usermod -u 2001 alice` und anschließend Besitz rekursiv korrigieren

### Benutzer löschen
- `sudo userdel alice` – Konto löschen, Home bleibt bestehen
- `sudo userdel -r alice` – Konto plus Home und Mailspool löschen
- Vorher prüfen, ob Dienste oder Cronjobs betroffen sind

---

## 3. Gruppenverwaltung

- Gruppe anlegen: `sudo groupadd projektX`
- Gruppe löschen: `sudo groupdel projektX`
- Gruppe umbenennen: `sudo groupmod -n neu alt`
- Benutzer zur **Primärgruppe**: `sudo usermod -g projektX alice`
- Benutzer zu **Sekundärgruppen**: `sudo usermod -aG projektX,video alice`
- Zugehörigkeiten prüfen: `id alice` oder als Benutzer `groups`

**Hinweis Teamordner**
- Ordner an Teamgruppe übergeben: `sudo chgrp -R projektX /srv/projektX`
- SGID setzen, damit neue Dateien die Gruppe erben: `sudo chmod g+s /srv/projektX`
- Optional mit ACLs Standardrechte festlegen, siehe Abschnitt 6

---

## 4. Benutzerwechsel und Privilegien

- `su alice` – zu Benutzer wechseln, Umgebung teils erhalten
- `su - alice` – Login-Shell mit Profil der Zielperson, setzt PATH und Umgebung frisch
- `sudo <befehl>` – Befehl mit erhöhten Rechten
  - Rechtevergabe in `/etc/sudoers` oder in `/etc/sudoers.d/`
  - immer mit `visudo` bearbeiten, Syntaxprüfung inklusive
  - Gruppen:
    - Debian/Ubuntu: Mitgliedschaft in `sudo`
    - RHEL/Fedora: Mitgliedschaft in `wheel`
- Als anderer Benutzer ausführen: `sudo -u alice befehl`
- Protokolle:
  - Debian/Ubuntu: `/var/log/auth.log`
  - RHEL/CentOS/Fedora: `/var/log/secure`

**Sicherheitsmerkpunkte**
- SUID-Binaries auf ein Minimum, regelmäßig prüfen
- `sudo` granular vergeben, lieber einzelne Befehle statt `ALL=ALL`
- Multi-Faktor-Auth für Admin-Accounts erwägen

---

## 5. Dateien und Ordner anlegen, löschen, verschieben

- Anlegen:
  - Datei: `touch datei.txt`
  - Verzeichnis: `mkdir ordner` oder rekursiv `mkdir -p proj/src`
  - Modus beim Anlegen: `mkdir -m 2775 teamdir` – setzt SGID und Rechte
- Löschen:
  - leere Ordner: `rmdir leererordner`
  - mit Inhalt: `rm -r ordner`
  - ohne Rückfragen: `rm -rf ordner` – sehr vorsichtig einsetzen
- Verschieben und Umbenennen:
  - `mv alt neu` oder `mv datei ordner/`
- Kopieren:
  - `cp datei ziel/`
  - Attribute erhalten: `cp -a quelle ziel/` – bewahrt Zeiten, Rechte, Owner
- Besitzer und Gruppe:
  - `chown user:gruppe pfad` – Besitzer setzen
  - rekursiv: `chown -R user:gruppe ordner/`
  - nur Gruppe ändern: `chgrp gruppe pfad`
- Rechte:
  - `chmod 640 datei`, `chmod -R 775 ordner`
- Typische Teamstruktur:
  - `sudo mkdir -p /srv/projekte/app`
  - `sudo chgrp -R projektX /srv/projekte/app`
  - `sudo chmod -R 2775 /srv/projekte/app` – SGID und Gruppen-Schreibrecht

---

## 6. ACLs – feinere Rechtevergabe

- Anzeigen: `getfacl pfad`
- Setzen individueller Rechte: `setfacl -m u:alice:rw,g:projektX:rX pfad`
- Standard-ACLs für neue Objekte in Ordnern:
  - `setfacl -d -m g:projektX:rwx /srv/projekte/app`
  - `-d` legt Default für zukünftige Einträge fest
- Entfernen einer ACL: `setfacl -x u:alice pfad`
- Komplett zurück auf klassische Unix-Rechte: `setfacl -b pfad`

---

## 7. Praxisrezepte

- Benutzer ohne Home und ohne Login-Shell:
  - `sudo useradd -M -s /usr/sbin/nologin dienst`
- Benutzer nachträglich in Docker-Gruppe aufnehmen:
  - `sudo usermod -aG docker alice` und neu einloggen
- Projektordner, in dem alle Teammitglieder schreiben dürfen, Dateien bleiben in Teamgruppe:
  - `sudo mkdir -p /srv/team/projekt`
  - `sudo chgrp -R projektX /srv/team/projekt`
  - `sudo chmod -R 2775 /srv/team/projekt`
- Temporär schreibbar für alle, aber vor versehentlichem Löschen geschützt:
  - `sudo chmod 1777 /srv/drop` – Sticky-Bit wie in `/tmp`

---

## 8. Häufige Stolpersteine

- `usermod -G` ohne `-a` überschreibt Sekundärgruppen
- `rm -rf /` oder falscher Pfad mit Wildcards – immer Ziel prüfen
- Verzeichnisrechte falsch verstanden:
  - `r` allein reicht nicht, um in Ordner zu wechseln
  - für Betreten braucht es `x`, für Auflisten zusätzlich `r`
- `umask` ignoriert Ausführungsrechte für Dateien bewusst
- SGID auf Dateien hat andere Bedeutung als auf Verzeichnissen

---

## 9. Mini-Spickzettel

- Rechte lesen: `ls -l`
- Besitzer setzen: `chown user:gruppe pfad`
- Rechte setzen numerisch: `chmod 640 datei`
- Rechte setzen symbolisch: `chmod u+rwx,g+rx,o-rw datei`
- Teamordner mit Gruppenvererbung: `chmod 2775 ordner`
- Sticky-Verzeichnis: `chmod 1777 ordner`
- Benutzer anlegen: `adduser name` oder `useradd -m name`
- Gruppenmitgliedschaft: `usermod -aG gruppe name` und `id name`
- Benutzerwechsel: `su - name` oder `sudo -u name befehl`
- Sudo bearbeiten: `visudo`

---

## 10. Prüfungsbezug AP1
- Rechtekette korrekt interpretieren und in Zahlen umrechnen
- `umask` Berechnung beherrschen
- Unterschied `su`, `su -`, `sudo` erklären
- Anlage und Verwaltung von Benutzern und Gruppen mit den Kernoptionen
- SGID und Sticky in Team- und Temp-Verzeichnissen begründen
- ACLs sinnvoll einsetzen, Standard-ACL definieren
---
<details style="margin-top: 2em;">
<summary style="font-size: 0.9em; color: #888;">Metadaten anzeigen</summary>
<p style="font-size: 0.85em; color: grey;">
Teil der FIAE-Umschulung (2025-2027) am BFW Muehlenbeck.<br>
Diese Mitschrift entstand im Unterricht am 17.09.2025 mit WED.<br>
Sie basiert auf gemeinsam erarbeiteten Inhalten und ergÃ¤nzenden Uebungsbeispielen vom 17.09.2025.<br><br>
Die Version wurde inhaltlich Ã¼berarbeitet, strukturell optimiert und technisch ergÃ¤nzt,<br>
um Lernerfolg, Pruefungsrelevanz und Nachvollziehbarkeit zu foerdern.<br><br>
Oeffentlich dokumentiert zur Wiederholung, Pruefungsvorbereitung und als Orientierungshilfe fuer Dritte.<br><br>
Quelle: Eigene Mitschrift & Unterrichtsinhalte<br>
Autor: Sean Conroy<br>
Lizenz: <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a>
</p>
</details>